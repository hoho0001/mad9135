<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Week 10: Progressive Web Apps | MAD9135</title>
    <meta name="description" content="HTML5 App Development">
    
    
    <link rel="preload" href="/mad9135/assets/css/0.styles.9611ce91.css" as="style"><link rel="preload" href="/mad9135/assets/js/app.93208c86.js" as="script"><link rel="preload" href="/mad9135/assets/js/10.1beb0a6d.js" as="script"><link rel="prefetch" href="/mad9135/assets/js/9.f3d9562e.js"><link rel="prefetch" href="/mad9135/assets/js/2.861402b7.js"><link rel="prefetch" href="/mad9135/assets/js/3.33f134f5.js"><link rel="prefetch" href="/mad9135/assets/js/4.03db1896.js"><link rel="prefetch" href="/mad9135/assets/js/5.3ba0d247.js"><link rel="prefetch" href="/mad9135/assets/js/6.7deeed88.js"><link rel="prefetch" href="/mad9135/assets/js/7.f6911785.js"><link rel="prefetch" href="/mad9135/assets/js/8.6011c2a9.js"><link rel="prefetch" href="/mad9135/assets/js/11.2127b566.js"><link rel="prefetch" href="/mad9135/assets/js/12.dacfbc12.js"><link rel="prefetch" href="/mad9135/assets/js/13.bb931c24.js"><link rel="prefetch" href="/mad9135/assets/js/14.9a561fc3.js"><link rel="prefetch" href="/mad9135/assets/js/15.e33dacd3.js"><link rel="prefetch" href="/mad9135/assets/js/16.2340cb16.js"><link rel="prefetch" href="/mad9135/assets/js/17.bb734bc3.js"><link rel="prefetch" href="/mad9135/assets/js/18.28f77630.js"><link rel="prefetch" href="/mad9135/assets/js/19.e0ee8262.js"><link rel="prefetch" href="/mad9135/assets/js/20.2c7096c5.js"><link rel="prefetch" href="/mad9135/assets/js/21.e743cc0e.js"><link rel="prefetch" href="/mad9135/assets/js/22.9ba274f1.js"><link rel="prefetch" href="/mad9135/assets/js/23.41eef8b5.js"><link rel="prefetch" href="/mad9135/assets/js/24.3af925d8.js"><link rel="prefetch" href="/mad9135/assets/js/25.b0083107.js"><link rel="prefetch" href="/mad9135/assets/js/26.9979bdc6.js"><link rel="prefetch" href="/mad9135/assets/js/27.0e1681b8.js">
    <link rel="stylesheet" href="/mad9135/assets/css/0.styles.9611ce91.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mad9135/" class="home-link router-link-active"><!----> <span class="site-name">MAD9135</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mad9135/overview/" class="nav-link">Overview</a></div><div class="nav-item"><a href="/mad9135/assignments/" class="nav-link">Assignments</a></div><div class="nav-item"><a href="/mad9135/resources/" class="nav-link">Resources</a></div><div class="nav-item"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mad9135/overview/" class="nav-link">Overview</a></div><div class="nav-item"><a href="/mad9135/assignments/" class="nav-link">Assignments</a></div><div class="nav-item"><a href="/mad9135/resources/" class="nav-link">Resources</a></div><div class="nav-item"><a href="https://github.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Content Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/mad9135/modules/week1/" class="sidebar-link">Week 1: Introduction &amp; Welcome</a></li><li><a href="/mad9135/modules/week2/" class="sidebar-link">Week 2: JavaScript Going Beyond Awesome</a></li><li><a href="/mad9135/modules/week3/" class="sidebar-link">Week 3: More ES6 and Intro to React</a></li><li><a href="/mad9135/modules/week4/" class="sidebar-link">Week 4: React App Fundamentals</a></li><li><a href="/mad9135/modules/week5/" class="sidebar-link">Week 5: React Components and Props</a></li><li><a href="/mad9135/modules/week6/" class="sidebar-link">Week 6: React Fragments, Refs, and Forms</a></li><li><a href="/mad9135/modules/week7/" class="sidebar-link">Week 7: Routing, AJAX, and ReactStrap</a></li><li><a href="/mad9135/modules/week8/" class="sidebar-link">Week 8: React Miscellaneous</a></li><li><a href="/mad9135/modules/week9/" class="sidebar-link">Week 9: React and Progressive Web Apps</a></li><li><a href="/mad9135/modules/week10/" class="active sidebar-link">Week 10: Progressive Web Apps</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mad9135/modules/week10/#service-workers" class="sidebar-link">Service Workers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mad9135/modules/week10/#how-to-register-a-service-worker" class="sidebar-link">How to register a Service Worker</a></li><li class="sidebar-sub-header"><a href="/mad9135/modules/week10/#create-a-manifest-json-file" class="sidebar-link">Create a manifest.json File</a></li><li class="sidebar-sub-header"><a href="/mad9135/modules/week10/#sample-service-worker-scripts" class="sidebar-link">Sample Service Worker Scripts</a></li><li class="sidebar-sub-header"><a href="/mad9135/modules/week10/#workbox-library" class="sidebar-link">WorkBox Library</a></li></ul></li><li class="sidebar-sub-header"><a href="/mad9135/modules/week10/#what-to-do-before-week-11" class="sidebar-link">What to do before Week 11</a></li></ul></li><li><a href="/mad9135/modules/week11/" class="sidebar-link">Week 11: React Native</a></li><li><a href="/mad9135/modules/week12/" class="sidebar-link">Week 12: React Native</a></li><li><a href="/mad9135/modules/week13/" class="sidebar-link">Week 13: React Native</a></li><li><a href="/mad9135/modules/week14/" class="sidebar-link">Week 14: React Native</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Assignments</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="week-10-progressive-web-apps"><a href="#week-10-progressive-web-apps" aria-hidden="true" class="header-anchor">#</a> Week 10: Progressive Web Apps</h1> <h2 id="service-workers"><a href="#service-workers" aria-hidden="true" class="header-anchor">#</a> Service Workers</h2> <ul><li>Service workers are external scripts that can be registered to run on another thread (in the background) and that can communicate with your webpage through event listeners.</li> <li>The most common use of service workers is to be enabled through a <code>manifest.json</code> file and to cache files so a web app can run off-line or during times of poor connection.</li></ul> <h3 id="how-to-register-a-service-worker"><a href="#how-to-register-a-service-worker" aria-hidden="true" class="header-anchor">#</a> How to register a Service Worker</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Use the window load event as a trigger to register your Service Worker</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'./sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>This script assumes that you called your file <code>sw.js</code> and that it is in the same folder.</li></ul> <h3 id="create-a-manifest-json-file"><a href="#create-a-manifest-json-file" aria-hidden="true" class="header-anchor">#</a> Create a manifest.json File</h3> <ul><li>In your HTML file, create a link that connects to the manifest file.</li> <li>Including this link can automatically prompt a user to add the website to their homescreen.</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>manifest<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./manifest.json<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>We never want to ask the user to install as soon as they arrive at the site.</p></div> <ul><li>Here is a script that will intercept that event and store it so we can call the prompt later on.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> installPromptEvent<span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeinstallprompt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ev<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ev<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//don't force the user to think `why would I ever do that?`</span>
    installPromptEvent <span class="token operator">=</span> ev<span class="token punctuation">;</span>  <span class="token comment">//save it for later</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">callInstallPrompt</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ev<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//call this on a button click or after a delay from your web app</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> installPromptEvent <span class="token operator">!==</span><span class="token operator">=</span> undefined <span class="token punctuation">)</span><span class="token punctuation">{</span>
        installPromptEvent<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>In the mainfest.json file (similar to a package.json) we would have most of the following.</li> <li>This is a sample version of a manifest.json file</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;short_name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;My App&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Longer version of App Name&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;icons&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token string">&quot;src&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;icon-48.png&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;image/png&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;size&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;48x48&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string">&quot;src&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;icon-96.png&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;image/png&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;size&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;96x96&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string">&quot;src&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;icon-192.png&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;image/png&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;size&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;192x192&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token string">&quot;src&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;icon-512.png&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;image/png&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;size&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;512x512&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;start_url&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;index.html?launcher=true&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;display&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;standalone&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;background_color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;#E4E4E4&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;theme_color&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;#BADA55&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;This is the description of my PWA&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>For <code>display</code> we can use <code>standalone</code>: URL bar disappears, <code>fullscreen</code>: URL bar and status bar disappear, <code>minimal-ui</code>: minor changes, <code>browser</code>: looks like every other webpage... so, why?</li> <li><code>standalone</code> is the recommended choice for PWAs.</li> <li>If you want to have Javascript that does something if the app loads like an web app instead of a web page then you can use this:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span> window<span class="token punctuation">.</span><span class="token function">matchMedia</span><span class="token punctuation">(</span><span class="token string">&quot;(display-mode: standalone)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>matches <span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//we loaded the page as a PWA, not a normal boring webpage</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token comment">//boring webpage</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="sample-service-worker-scripts"><a href="#sample-service-worker-scripts" aria-hidden="true" class="header-anchor">#</a> Sample Service Worker Scripts</h3> <ul><li>Once you have your <code>&lt;link&gt;</code>, your <code>manifest.json</code> file, and you have registered your Service Worker script then it is time to add something to that file.</li> <li>Every thing that you want to cache needs to be grouped together in a CacheStorage object, which needs a name and an array of filenames.</li> <li>Do this at the top of the <code>sw.js</code> file.</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">CACHE_VERSION</span> <span class="token operator">=</span> <span class="token string">'v1.7'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">CACHE_LIST</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'favicon.ico'</span><span class="token punctuation">,</span>
    <span class="token string">'index.html'</span><span class="token punctuation">,</span>
    <span class="token string">'main.js'</span><span class="token punctuation">,</span>
    <span class="token string">'img/200.jpeg'</span><span class="token punctuation">,</span>
    <span class="token string">'img/404.jpeg'</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Think of these as a pair that stays together.</li> <li>Then the Service Worker has various event listeners that run at different times.</li> <li>There is an install phase that happens when your main script registers the service worker file.</li> <li>This will trigger the <code>install</code> event.</li> <li>The second phase is the <code>activate</code> phase where the Service Worker starts to run and do its work.</li> <li>The third phase happens each time the browser tries to load a file. There is a <code>fetch</code> event that happens for every file.</li> <li>The Service Worker will be intercepting these fetch calls and deciding where to get the file from the cache, or the network, or both.</li> <li>Here is a sample script showing a script running at each event.</li></ul> <p><strong>INSTALL PHASE</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//step one... initial install</span>
    
    <span class="token comment">//get all the cacheStorage objects</span>
    <span class="token comment">//try to open a specific version</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'installing the cache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ev<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span> 
        caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_VERSION</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>cache<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">//install all the files in that cache</span>
            <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token constant">CACHE_LIST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>            
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>ACTIVATE PHASE</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//step two... activate the service worker</span>
    <span class="token comment">//make a list of which cache versions are ok</span>
    <span class="token comment">//it is a list because you could have different caches for different file types, etc.</span>
    <span class="token keyword">const</span> cacheWhiteList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'v1.7'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'activating the cache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//get the list of all the cacheStorage keys</span>
    ev<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
        caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>keys<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//run this function once you have a list of current cache version keys</span>
            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">//test all the keys in the array</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>cacheWhiteList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">//remove caches if they are not in the whitelist</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'remove cache'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'got cache'</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>FETCH PHASE</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//step three... handle all the requests from the browser</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'handling fetch from browser for'</span><span class="token punctuation">,</span> ev<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    ev<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
        caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Found'</span><span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token string">'in cache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> response<span class="token punctuation">;</span> <span class="token comment">//back to the browser from the cache</span>
            <span class="token punctuation">}</span>
            console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'No response match found in cache. Go to the network for'</span><span class="token punctuation">,</span> ev<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> fetchRequest <span class="token operator">=</span> ev<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">//go to the network</span>
            <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        <span class="token comment">//if you want to save all fetched files to the cache</span>
                        <span class="token keyword">let</span> responseStreamToCache <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_VERSION</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">//cache the response for the next visit</span>
                            <span class="token comment">//cache.put(ev.request, responseStreamToCache);</span>
                          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//return what came back from the network</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resp <span class="token operator">||</span> resp<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token number">200</span> <span class="token operator">||</span> resp<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">'basic'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">return</span> resp<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                            <span class="token comment">//failed to get from the network</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>request<span class="token punctuation">.</span>destination <span class="token operator">===</span> <span class="token string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token comment">//send back a cached image for non-cached images</span>
                                <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'img/404.jpeg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// If both fail, show a generic fallback:</span>
          <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">'/offline.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// However, in reality you'd have many different</span>
          <span class="token comment">// fallbacks, depending on URL &amp; headers.</span>
          <span class="token comment">// Eg, a fallback silhouette image for avatars.</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>You can see that even this simple example has a LOT of boilerplate code to handle a few files and requests.</li> <li>There are also other events that can happen in the third phase after the service worker has been activated.</li> <li>These other events include <code>sync</code>, <code>push</code>, <code>message</code>, and <code>statechange</code>.</li> <li>Initial <strong>LIMITED</strong> support for manifest.json files was added in iOS 11.3.</li></ul> <div class="danger custom-block"><p class="custom-block-title">iOS Warning</p> <p>Apple has done a terrible job of staying up to date with PWA technology.</p> <p>iOS 11 and iOS 12 both lack support for many of the features of PWAs.</p> <p>iOS 11.3 still looks for a series of meta tags to let users add webpages to their home screen.</p> <p>iOS 12.1 still fails to let PWAs access file inputs, the camera, or getUserMedia, no support for push notifications or background sync, plus it will remove any Service Workers and cached files after a couple weeks.</p></div> <h3 id="workbox-library"><a href="#workbox-library" aria-hidden="true" class="header-anchor">#</a> WorkBox Library</h3> <ul><li><p>Google has created a library that reduces the amount of boilerplate code you will need to create a Service Worker that handles the caching of files.</p></li> <li><p><a href="https://developers.google.com/web/tools/workbox/" target="_blank" rel="noopener noreferrer">WorkBox<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://developers.google.com/web/tools/workbox/guides/get-started" target="_blank" rel="noopener noreferrer">WorkBox Guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>Your next assignment will be to research and use WorkBox to create a SIMPLE PWA.</p></li> <li><p>Don't worry, it will be tested on an Android device.</p></li> <li><p>Great <a href="https://medium.com/google-developer-experts/a-5-minute-intro-to-workbox-3-0-156803952b3e" target="_blank" rel="noopener noreferrer">WorkBox Tutorial<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h2 id="what-to-do-before-week-11"><a href="#what-to-do-before-week-11" aria-hidden="true" class="header-anchor">#</a> What to do before Week 11</h2> <div class="warning custom-block"><p class="custom-block-title">TODO</p> <ul><li>Select your Pairs Programming partner (Someone you do not usually work with) and tell your professor who it is.</li> <li>Start to work on your <a href="/mad9135/modules/assignments/">Progressive Web App</a></li></ul></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: : </span> <span class="time">11/14/2018, 2:26:51 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/mad9135/modules/week9/" class="prev">
          Week 9: React and Progressive Web Apps
        </a></span> <span class="next"><a href="/mad9135/modules/week11/">
          Week 11: React Native
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/mad9135/assets/js/10.1beb0a6d.js" defer></script><script src="/mad9135/assets/js/app.93208c86.js" defer></script>
  </body>
</html>
